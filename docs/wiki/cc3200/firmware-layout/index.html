<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Important Toniebox firmware files # File Description /cert/ca.der Contains the Certificate Authority to check the https connection for the api /cert/private.der Private key of the box, don&rsquo;t share, it is used to identificate agains the cloud /cert/client.der Public key of the box, don&rsquo;t share /sys/mcuimg.bin Original bootloader /sys/mcuimg1.bin First original firmware slot /sys/mcuimg2.bin Second original firmware slot /sys/mcuimg3.bin Third original firmware slot /sys/mcubootinfo.bin Decides which firmware slot to boot Analysing the Toniebox firmware image format # The Toniebox uses the image structure just like in the cc3200-sdk from ti."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Firmware layout"><meta property="og:description" content="Important Toniebox firmware files # File Description /cert/ca.der Contains the Certificate Authority to check the https connection for the api /cert/private.der Private key of the box, don&rsquo;t share, it is used to identificate agains the cloud /cert/client.der Public key of the box, don&rsquo;t share /sys/mcuimg.bin Original bootloader /sys/mcuimg1.bin First original firmware slot /sys/mcuimg2.bin Second original firmware slot /sys/mcuimg3.bin Third original firmware slot /sys/mcubootinfo.bin Decides which firmware slot to boot Analysing the Toniebox firmware image format # The Toniebox uses the image structure just like in the cc3200-sdk from ti."><meta property="og:type" content="article"><meta property="og:url" content="https://tonies-wiki.revvox.de/docs/wiki/cc3200/firmware-layout/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-11-20T14:03:54+00:00"><title>Firmware layout | Toniebox Hacking</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.min.e2994ec3dc0cc7d1d85b138ad4e4c3f02d8abfa8b8471dfe0ab15a7a8a77d6ee.css integrity="sha256-4plOw9wMx9HYWxOK1OTD8C2Kv6i4Rx3+CrFaeop31u4=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.8414885d4625632152258896ac1ed986b6bd86e12d3d8dc605bca97dbc2a3e37.js integrity="sha256-hBSIXUYlYyFSJYiWrB7Zhra9huEtPY3GBbypfbwqPjc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Toniebox Hacking</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></label><ul></ul></li></ul><ul><li><a href=/docs/how-to-get-started/>How to get started?</a><ul></ul></li><li><a href=/docs/rules/>Community Guidelines</a><ul></ul></li><li><a href=/docs/faq/>Frequently Asked Questions</a><ul></ul></li><li><span>Tools</span><ul><li><a href=/docs/tools/teddybench/>teddyBench</a><ul></ul></li><li><input type=checkbox id=section-a95e960a612f8fbab37aea668df2b6d5 class=toggle>
<label for=section-a95e960a612f8fbab37aea668df2b6d5 class="flex justify-between"><a href=/docs/tools/teddycloud/>teddyCloud</a></label><ul><li><input type=checkbox id=section-e3fdb821ecd591a792d8991d8793a35a class=toggle>
<label for=section-e3fdb821ecd591a792d8991d8793a35a class="flex justify-between"><a href=/docs/tools/teddycloud/usage/custom-tags/>Custom Tags</a></label></li><li><input type=checkbox id=section-9523e024da2d7ee74b826d07de2251dc class=toggle>
<label for=section-9523e024da2d7ee74b826d07de2251dc class="flex justify-between"><a href=/docs/tools/teddycloud/setup/>Setup</a></label><ul><li><input type=checkbox id=section-7133c53a2ea2209d7783202afb657f91 class=toggle>
<label for=section-7133c53a2ea2209d7783202afb657f91 class="flex justify-between"><a href=/docs/tools/teddycloud/setup/dump-certs/>Dump certificates</a></label><ul><li><a href=/docs/tools/teddycloud/setup/dump-certs/cc3200/>CC3200</a></li><li><a href=/docs/tools/teddycloud/setup/dump-certs/cc3235/>CC3235</a></li><li><a href=/docs/tools/teddycloud/setup/dump-certs/esp32/>ESP32</a></li></ul></li><li><input type=checkbox id=section-11c7b98653ea035f089a56d7c6e35235 class=toggle>
<label for=section-11c7b98653ea035f089a56d7c6e35235 class="flex justify-between"><a href=/docs/tools/teddycloud/setup/flash-ca/>Flash replacement CA</a></label><ul><li><a href=/docs/tools/teddycloud/setup/flash-ca/cc3200/>CC3200</a></li><li><a href=/docs/tools/teddycloud/setup/flash-ca/cc3235/>CC3235</a></li><li><a href=/docs/tools/teddycloud/setup/flash-ca/esp32/>ESP32</a></li></ul></li><li><input type=checkbox id=section-94896593d2bbd10884321ac3a1d237a1 class=toggle>
<label for=section-94896593d2bbd10884321ac3a1d237a1 class="flex justify-between"><a href=/docs/tools/teddycloud/setup/dns/>DNS</a></label><ul><li><a href=/docs/tools/teddycloud/setup/dns/cc3200/>CC3200</a></li><li><a href=/docs/tools/teddycloud/setup/dns/cc3235/>CC3235</a></li><li><a href=/docs/tools/teddycloud/setup/dns/esp32/>ESP32</a></li></ul></li><li><input type=checkbox id=section-87ae8ba146e78bcefd62407b91e1c638 class=toggle>
<label for=section-87ae8ba146e78bcefd62407b91e1c638 class="flex justify-between"><a href=/docs/tools/teddycloud/setup/error-codes/>Error codes</a></label></li><li><input type=checkbox id=section-0146e7f6eb9ff74d170906a54941d7a0 class=toggle>
<label for=section-0146e7f6eb9ff74d170906a54941d7a0 class="flex justify-between"><a href=/docs/tools/teddycloud/setup/supported-server-hardware/>Supported NAS/Server hardware</a></label></li><li><input type=checkbox id=section-b0544fbca97b173f472deb52fd233835 class=toggle>
<label for=section-b0544fbca97b173f472deb52fd233835 class="flex justify-between"><a href=/docs/tools/teddycloud/setup/test-troubleshooting/>Test & Troubleshooting</a></label></li></ul></li><li><input type=checkbox id=section-62746cc9c650d56f5986fdf1c6d399ee class=toggle>
<label for=section-62746cc9c650d56f5986fdf1c6d399ee class="flex justify-between"><a role=button>Technical Docs</a></label><ul><li><input type=checkbox id=section-1b26af4095794de335a4266f5f0d1fd7 class=toggle>
<label for=section-1b26af4095794de335a4266f5f0d1fd7 class="flex justify-between"><a href=/docs/tools/teddycloud/tecdoc/content-json/>content-json config</a></label></li><li><input type=checkbox id=section-919aea1bc5b4ca1dc4c6cb818efed4e4 class=toggle>
<label for=section-919aea1bc5b4ca1dc4c6cb818efed4e4 class="flex justify-between"><a href=/docs/tools/teddycloud/tecdoc/edit-local/>Edit JSON files with vscode</a></label></li><li><input type=checkbox id=section-f7171afa2b947249eea094548419c731 class=toggle>
<label for=section-f7171afa2b947249eea094548419c731 class="flex justify-between"><a href=/docs/tools/teddycloud/tecdoc/playlist-tap-json/>Playlists (TAP)</a></label></li><li><input type=checkbox id=section-de6f1b9043bddb49f7343761ffc28fdf class=toggle>
<label for=section-de6f1b9043bddb49f7343761ffc28fdf class="flex justify-between"><a href=/docs/tools/teddycloud/tecdoc/toniesboxes-custom-json/>tonieboxes-custom-json</a></label></li><li><input type=checkbox id=section-b359222ea3151b774d472f2c756be4ec class=toggle>
<label for=section-b359222ea3151b774d472f2c756be4ec class="flex justify-between"><a href=/docs/tools/teddycloud/tecdoc/tonies-custom-json/>tonies.custom.json config</a></label></li></ul></li></ul></li></ul></li><li><span>Box Variants</span><ul><li><a href=/docs/box-variants/esp32/>ESP32</a></li></ul></li><li><span>Custom Firmware</span><ul><li><input type=checkbox id=section-42e43c8e420eed49ce3d0915aa7a0f11 class=toggle>
<label for=section-42e43c8e420eed49ce3d0915aa7a0f11 class="flex justify-between"><a role=button>CC3200</a></label><ul><li><input type=checkbox id=section-fb4cb61a40d81e2312fca285b90fac32 class=toggle>
<label for=section-fb4cb61a40d81e2312fca285b90fac32 class="flex justify-between"><a href=/docs/custom-firmware/cc3200/hackieboxng-bl/>HackieboxNG Bootloader</a></label><ul><li><a href=/docs/custom-firmware/cc3200/hackieboxng-bl/install/>Installation</a></li><li><a href=/docs/custom-firmware/cc3200/hackieboxng-bl/bootloader/>Bootloader</a></li><li><a href=/docs/custom-firmware/cc3200/hackieboxng-bl/ofw-patches/>Firmware patches</a></li></ul></li><li><input type=checkbox id=section-e6b6fb6492df9b2143f091c829117a9d class=toggle>
<label for=section-e6b6fb6492df9b2143f091c829117a9d class="flex justify-between"><a href=/docs/custom-firmware/cc3200/hackiebox-cfw/>Hackiebox CFW PoC</a></label><ul><li><a href=/docs/custom-firmware/cc3200/hackiebox-cfw/api/>Hackiebox API</a></li></ul></li></ul></li><li><input type=checkbox id=section-96fc9f3b17ed6977851c210f7d13b6ef class=toggle>
<label for=section-96fc9f3b17ed6977851c210f7d13b6ef class="flex justify-between"><a role=button>ESP32</a></label><ul><li><a href=/docs/custom-firmware/esp32/teddybox/>TeddyBox CFW</a><ul></ul></li></ul></li></ul></li><li><a href=/docs/wiki/>Wiki</a><ul><li><input type=checkbox id=section-d8f00f9faa706cfd8232ca710ec83905 class=toggle checked>
<label for=section-d8f00f9faa706cfd8232ca710ec83905 class="flex justify-between"><a role=button>CC3200</a></label><ul><li><a href=/docs/wiki/cc3200/boot-process/>Boot Process</a></li><li><a href=/docs/wiki/cc3200/debug-port/>Debug port</a></li><li><a href=/docs/wiki/cc3200/firmware-layout/ class=active>Firmware layout</a></li><li><a href=/docs/wiki/cc3200/firmware-list/>Firmware list</a></li><li><a href=/docs/wiki/cc3200/hardware/>Hardware</a></li><li><a href=/docs/wiki/cc3200/microsd-compatibility/>microSD compatibility</a></li><li><a href=/docs/wiki/cc3200/pinout/>Pinout</a></li></ul></li><li><input type=checkbox id=section-67f43499674643a099dd84c6cb56579b class=toggle>
<label for=section-67f43499674643a099dd84c6cb56579b class="flex justify-between"><a role=button>ESP32</a></label><ul><li><a href=/docs/wiki/esp32/pinout/>Pinout</a></li></ul></li><li><input type=checkbox id=section-682231c8b0ba39c29d77ab65a2a7a682 class=toggle>
<label for=section-682231c8b0ba39c29d77ab65a2a7a682 class="flex justify-between"><a role=button>General</a></label><ul><li><a href=/docs/wiki/general/glossary/>Glossary</a></li><li><a href=/docs/wiki/general/audio-file-format/>Audio file format</a></li><li><a href=/docs/wiki/general/battery-power-supply/>Battery & Power supply</a></li><li><a href=/docs/wiki/general/internal-audio-files/>Internal audio files</a></li><li><a href=/docs/wiki/general/known-problems/>Known problems</a></li><li><a href=/docs/wiki/general/protocol-analysis/>Protocol analysis</a></li><li><a href=/docs/wiki/general/replacement-parts/>Replacement parts</a></li><li><a href=/docs/wiki/general/traffic-sniffing/>Traffic sniffing</a></li><li><a href=/docs/wiki/general/useful-links/>Useful links</a></li></ul></li><li><input type=checkbox id=section-208ce0560e3e7d166dff7af7bf56d73e class=toggle>
<label for=section-208ce0560e3e7d166dff7af7bf56d73e class="flex justify-between"><a role=button>Toniebox 2</a></label><ul><li><a href=/docs/wiki/tb2-v1/hardware/>Hardware</a></li><li><a href=/docs/wiki/tb2-v1/pinout/>Pinout</a></li></ul></li></ul></li></ul><ul><li><a href target=_blank rel=noopener>More</a><ul><li><a href=https://github.com/toniebox-reverse-engineering target=_blank rel=noopener>GitHub</a></li><li><a href=https://t.me/toniebox_reverse_engineering target=_blank rel=noopener>Telegram Chat</a></li><li><a href=https://forum.revvox.de/ target=_blank rel=noopener>Discourse Forum</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Firmware layout</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#format-of-toniebox-bootinfo-reversed-with-radare2>Format of Toniebox Bootinfo reversed with radare2</a></li><li><a href=#format-of-toniebox-ofw-image-reversed-with-radare2>Format of Toniebox OFW Image reversed with radare2</a></li><li><a href=#format-of-toneibox-original-bootloader-reversed-with-radare2>Format of Toneibox original bootloader reversed with radare2</a></li><li><a href=#python-tool-for-extracting-all-this-information-by-your-own>Python tool for extracting all this information by your own</a></li></ul></nav></aside></header><article class=markdown><h1 id=important-toniebox-firmware-files>Important Toniebox firmware files
<a class=anchor href=#important-toniebox-firmware-files>#</a></h1><table><thead><tr><th>File</th><th>Description</th></tr></thead><tbody><tr><td>/cert/ca.der</td><td>Contains the Certificate Authority to check the https connection for the api</td></tr><tr><td>/cert/private.der</td><td>Private key of the box, don&rsquo;t share, it is used to identificate agains the cloud</td></tr><tr><td>/cert/client.der</td><td>Public key of the box, don&rsquo;t share</td></tr><tr><td>/sys/mcuimg.bin</td><td>Original bootloader</td></tr><tr><td>/sys/mcuimg1.bin</td><td>First original firmware slot</td></tr><tr><td>/sys/mcuimg2.bin</td><td>Second original firmware slot</td></tr><tr><td>/sys/mcuimg3.bin</td><td>Third original firmware slot</td></tr><tr><td>/sys/mcubootinfo.bin</td><td>Decides which firmware slot to boot</td></tr></tbody></table><h1 id=analysing-the-toniebox-firmware-image-format>Analysing the Toniebox firmware image format
<a class=anchor href=#analysing-the-toniebox-firmware-image-format>#</a></h1><p>The Toniebox uses the image structure just like in the cc3200-sdk from ti.
So from to-sdl/1.5.0/flc/flc.h see the following header:</p><pre tabindex=0><code>#ifndef FAST_BOOT
#define IMG_BOOT_INFO           &#34;/sys/mcubootinfo.bin&#34;
#define IMG_FACTORY_DEFAULT     &#34;/sys/mcuimg1.bin&#34;
#define IMG_USER_1              &#34;/sys/mcuimg2.bin&#34;
#define IMG_USER_2              &#34;/sys/mcuimg3.bin&#34;
#else
#define IMG_BOOT_INFO           &#34;/sys/mcureserved.bin&#34;
#define IMG_USER_1              &#34;/sys/mcuimg.bin&#34;
#define IMG_USER_2              &#34;/sys/mcuflpatch.bin&#34;
#endif
  
/******************************************************************************
   Image status
*******************************************************************************/
#define IMG_STATUS_TESTING      0x12344321
#define IMG_STATUS_TESTREADY    0x56788765
#define IMG_STATUS_NOTEST       0xABCDDCBA

/******************************************************************************
   Active Image
*******************************************************************************/
#define IMG_ACT_FACTORY         0
#define IMG_ACT_USER1           1
#define IMG_ACT_USER2           2
</code></pre><p>As we can see they are using 4 images. First one is the mcubootinfo.bin. Next one is the mcuimg1.bin and the next two images
are indented to be used for OTA updates while the first one is inteded to be the factory reset/default image kind of backup.</p><h2 id=format-of-toniebox-bootinfo-reversed-with-radare2>Format of Toniebox Bootinfo reversed with radare2
<a class=anchor href=#format-of-toniebox-bootinfo-reversed-with-radare2>#</a></h2><p>Let&rsquo;s check the mcubootinfo.bin first, so open it with radare2.</p><pre tabindex=0><code>% r2 mcubootinfo.bin 
 -- Run your own r2 scripts in awk using the r2awk program.
[0x00000000]&gt; x
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00000000  02d8 0320 badc cdab ffff ffff ffff ffff  ... ............
0x00000010  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000020  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000030  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000040  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000050  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000060  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000070  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000080  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x00000090  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x000000a0  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x000000b0  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x000000c0  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x000000d0  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x000000e0  ffff ffff ffff ffff ffff ffff ffff ffff  ................
0x000000f0  ffff ffff ffff ffff ffff ffff ffff ffff  ................
[0x00000000]&gt; 
</code></pre><p>As we can see it is only a 8 byte big file.</p><pre tabindex=0><code> % ls -lisa mcubootinfo.bin
8632122446 8 -rw-r--r--  1 kai  staff  8 18 Feb 22:35 mcubootinfo.bin
</code></pre><p>First of all we need to find the correct matches for the defines IMG_STATUS_TESTING, IMG_STATUS_TESTREADY, IMG_STATUS_NOTEST.
Remember ARM is little endian based, that means 0xABCDDCBA will become 0xBADCCDAB in our binary.</p><pre tabindex=0><code>% r2 mcubootinfo.bin      
 -- A C program is like a fast dance on a newly waxed dance floor by people carrying razors - Waldi Ravens
[0x00000000]&gt; /x badccdab
Searching 4 bytes in [0x0-0x8]
hits: 1
0x00000004 hit4_0 badccdab
[0x00000000]&gt; 
</code></pre><p>And of course we get a macht for this byte. So in this case we will boot our image in NOTEST mode. The selected Image is 0x02 beacuse the first byte is read from the bootloader due to flc.c:</p><pre tabindex=0><code>[0x00000000]&gt; x 4
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00000000  02d8 0320   
</code></pre><p>So agian we need to rememeber it is little endian and it is 4 byte aligned so only 0x02 is used, the other bytes seen should be just garbage due to the 4 byte alignment.</p><p>Examples for other modes an images can look like this:</p><p>TESTREADY:</p><pre tabindex=0><code>- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00000000  02d8 0320 6587 7856       
</code></pre><p>TESTING mit Image 0x01:</p><pre tabindex=0><code>- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00000000  01d8 0320 2143 3412     
</code></pre><h2 id=format-of-toniebox-ofw-image-reversed-with-radare2>Format of Toniebox OFW Image reversed with radare2
<a class=anchor href=#format-of-toniebox-ofw-image-reversed-with-radare2>#</a></h2><p>First of all let&rsquo;s start with the interesting informations at the end of the files.</p><pre tabindex=0><code> % r2 mcuimg2.bin 
 -- A git pull a day keeps the segfault away
[0x00000000]&gt; sG
[0x000266e6]&gt; s -2
[0x000266e4]&gt; x -220
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00026608  0300 0000 4555 5f56 332e 302e 365f 4246  ....EU_V3.0.6_BF
0x00026618  312d 3000 4555 5f56 332e 302e 365f 7374  1-0.EU_V3.0.6_st
0x00026628  6162 6c65 5f62 7261 6e63 6800 0500 acbe  able_branch.....
0x00026638  0000 0000 bb1b 4c5e 0000 0000 6161 3232  ......L^....aa22
0x00026648  6236 3200 3138 2046 6562 2031 383a 3135  b62.18 Feb 18:15
0x00026658  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026668  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026678  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026688  0001 0200 0100 010d 0000 0000 0000 0000  ................
0x00026698  0200 0000 0000 0000 0500 acbe 3131 6661  ............11fa
0x000266a8  3362 3832 3733 6237 6530 6439 3837 3131  3b8273b7e0d98711
0x000266b8  3566 6136 6263 3630 3031 6131 6166 3163  5fa6bc6001a1af1c
0x000266c8  6339 3433 3562 3330 3338 3831 3132 3436  c9435b3038811246
0x000266d8  6232 3030 3663 6565 6539 3866            b2006ceee98f
f[0x000266e4]&gt; 
</code></pre><p>It seems we have a creation date, a version number and an hash as well as an git shorthash in the file end.
Let&rsquo;s proof the hash algorithm, assuming we have sha256 because of the given length.</p><pre tabindex=0><code> % r2 mcuimg2.bin
 -- Finnished a beer
[0x00000000]&gt; sG 
[0x000266e6]&gt; s -2
[0x000266e4]&gt; x -160
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00026644  6161 3232 6236 3200 3138 2046 6562 2031  aa22b62.18 Feb 1
0x00026654  383a 3135 0000 0000 0000 0000 0000 0000  8:15............
0x00026664  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026674  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026684  0000 0000 0001 0200 0100 010d 0000 0000  ................
0x00026694  0000 0000 0200 0000 0000 0000 0500 acbe  ................
0x000266a4  3131 6661 3362 3832 3733 6237 6530 6439  11fa3b8273b7e0d9
0x000266b4  3837 3131 3566 6136 6263 3630 3031 6131  87115fa6bc6001a1
0x000266c4  6166 3163 6339 3433 3562 3330 3338 3831  af1cc9435b303881
0x000266d4  3132 3436 6232 3030 3663 6565 6539 3866  1246b2006ceee98f
[0x000266e4]&gt; s 0
[0x00000000]&gt; ph sha256 0x000266a4
11fa3b8273b7e0d987115fa6bc6001a1af1cc9435b3038811246b2006ceee98f
</code></pre><p>Rocks, seems that we have found everything to calculate an valid toniebox hash by our own.
So we can found the following ofsets, relativly to EOF:</p><ul><li>from -160 to -153 the git shorthash</li><li>from -152 to -140 the creation date</li><li>from -64 to EOF the SHA256 hash of the file</li></ul><p>Unfortunately the version string isn&rsquo;t so fix and differs in it&rsquo;s length
see 3.0.6 for example in comparison to version 3.0.7. and 3.0.8</p><pre tabindex=0><code> % r2 mcuimg2.bin
 -- Documentation is for weak people.
[0x00000000]&gt; sG
[0x000266e6]&gt; s -2
[0x000266e4]&gt; x -220
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00026608  0300 0000 4555 5f56 332e 302e 365f 4246  ....EU_V3.0.6_BF
0x00026618  312d 3000 4555 5f56 332e 302e 365f 7374  1-0.EU_V3.0.6_st
0x00026628  6162 6c65 5f62 7261 6e63 6800 0500 acbe  able_branch.....
0x00026638  0000 0000 bb1b 4c5e 0000 0000 6161 3232  ......L^....aa22
0x00026648  6236 3200 3138 2046 6562 2031 383a 3135  b62.18 Feb 18:15
0x00026658  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026668  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026678  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00026688  0001 0200 0100 010d 0000 0000 0000 0000  ................
0x00026698  0200 0000 0000 0000 0500 acbe 3131 6661  ............11fa
0x000266a8  3362 3832 3733 6237 6530 6439 3837 3131  3b8273b7e0d98711
0x000266b8  3566 6136 6263 3630 3031 6131 6166 3163  5fa6bc6001a1af1c
0x000266c8  6339 3433 3562 3330 3338 3831 3132 3436  c9435b3038811246
0x000266d8  6232 3030 3663 6565 6539 3866            b2006ceee98f
f[0x000266e4]&gt; 
</code></pre><pre tabindex=0><code>% r2 mcuimg1.bin 
 -- Select your character: RBin Wizard, Master Anal Paladin, or Assembly Warrior
[0x00000000]&gt; sG
[0x0002841a]&gt; s -2
[0x00028418]&gt; x -220
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x0002833c  0100 0000 0002 0000 5044 5f56 332e 302e  ........PD_V3.0.
0x0002834c  372d 3000 5044 5f56 332e 302e 375f 7374  7-0.PD_V3.0.7_st
0x0002835c  6162 6c65 5f62 7261 6e63 6800 0500 acbe  able_branch.....
0x0002836c  0000 0000 33a2 c75f 0000 0000 3339 6133  ....3.._....39a3
0x0002837c  6166 3700 3032 2044 6563 2031 353a 3138  af7.02 Dec 15:18
0x0002838c  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x0002839c  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000283ac  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000283bc  0001 0200 0100 010e 0000 0000 0000 0000  ................
0x000283cc  0300 0000 0000 0000 0500 acbe 6233 3565  ............b35e
0x000283dc  3665 3233 6238 3539 6662 3332 6565 3930  6e23b859fb32ee90
0x000283ec  3838 6562 6231 6130 3961 6165 3363 6163  88ebb1a09aae3cac
0x000283fc  3163 3933 3032 3365 3636 6166 6635 3336  1c93023e66aff536
0x0002840c  6463 6561 3664 3564 3439 3862            dcea6d5d498b
[0x00028418]&gt; 
</code></pre><pre tabindex=0><code>% r2 mcuimg3.bin 
 -- This is an unregistered copy.
[0x00000000]&gt; sG
[0x00027cab]&gt; s -2
[0x00027ca9]&gt; x -220
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x00027bcd  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00027bdd  0000 00aa aaaa aa45 555f 5633 2e30 2e38  .......EU_V3.0.8
0x00027bed  2d30 0033 2e30 2e38 5f45 5500 0500 acbe  -0.3.0.8_EU.....
0x00027bfd  0000 0000 fb19 875f 0000 0000 3333 6434  ......._....33d4
0x00027c0d  6633 6100 3134 204f 6374 2031 373a 3332  f3a.14 Oct 17:32
0x00027c1d  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00027c2d  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00027c3d  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00027c4d  0001 0200 0100 010e 0000 0000 0000 0000  ................
0x00027c5d  0200 0000 0000 0000 0500 acbe 6632 6565  ............f2ee
0x00027c6d  3433 3365 3036 3330 6135 3632 3433 3234  433e0630a5624324
0x00027c7d  3237 3764 3736 3363 6533 6337 6165 6131  277d763ce3c7aea1
0x00027c8d  3633 3061 3961 3037 6134 6239 3831 3766  630a9a07a4b9817f
0x00027c9d  3039 3535 3066 3235 6665 3536            09550f25fe56
[0x00027ca9]&gt; 
</code></pre><p>But every version string seems to have the pattern _V included, lets try to build
an regular expression for it and every version string is followed by the bytes
0500 acbe so far, we could use that to find an start point for our search.</p><p>Another very interessting observation are the bytes 0xBEAC0005 at the end of the file just
right before the SHA256 hash.</p><h2 id=format-of-toneibox-original-bootloader-reversed-with-radare2>Format of Toneibox original bootloader reversed with radare2
<a class=anchor href=#format-of-toneibox-original-bootloader-reversed-with-radare2>#</a></h2><pre tabindex=0><code>% r2 mcuimg.bin
 -- AHHHHH!!!! ASSEMBLY CODE!!!!!! HOLD ME I&#39;M SCARED!!!!!!!!!!
[0x00000000]&gt; sG
[0x000051de]&gt; s -2
[0x000051dc]&gt; x -250
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x000050e2  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000050f2  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00005102  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00005112  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00005122  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x00005132  0000 0000 0000 0000 0000 0000 0000 93c7  ................
0x00005142  0320 b4c7 0320 fac7 0320 e1c7 0320 1dc7  . ... ... ... ..
0x00005152  0320 a6c7 0320 a1c7 0320 8fc7 0320 c6c7  . ... ... ... ..
0x00005162  0320 d9c7 0320 99c7 0320 0500 acbe 0000  . ... ... ......
0x00005172  0000 456d c957 0000 0000 3039 6336 3337  ..Em.W....09c637
0x00005182  3400 4672 6920 5365 7020 2032 2031 343a  4.Fri Sep  2 14:
0x00005192  3135 3a30 3120 4345 5354 2032 3031 3600  15:01 CEST 2016.
0x000051a2  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000051b2  0000 0000 0000 0000 0000 0000 0000 0001  ................
0x000051c2  0200 0100 0106 0000 0000 100e 0000 0000  ................
0x000051d2  0000 2c01 1000 0500 acbe                 ..,.......
[0x000051dc]&gt; 
</code></pre><p>So as we can see we get the same EOF indicator as within the mcuimgX.bin images.
But it seems like there is no hash stored within the bootloader itself. Won&rsquo;t make
sense at all, because the is no bootstage that could verify the correct hash of the BL.
But we get an git shorthash and an timestamp again.</p><h2 id=python-tool-for-extracting-all-this-information-by-your-own>Python tool for extracting all this information by your own
<a class=anchor href=#python-tool-for-extracting-all-this-information-by-your-own>#</a></h2><p>During the reversing of all this cool there was a python tool developped for extracting all this information by your own
if you are afraid for hex editors. It has some nice features like recursive mode, csv and json export so you can extract this informations from any folder you like. For the toniebox users out there who have a big collection of firmware images :)</p><p>Find the tool here: <a href=https://github.com/toniebox-reverse-engineering/toniebox/blob/master/tools/firmware_info.py>Firmware Information Extractor</a></p><p>It is almost self explaining and has a help menue:</p><pre tabindex=0><code>%% ./firmware_info.py -r testfolder/foo


Filename: testfolder/foo/mcuimg2.bin
Firmware Version: 	EU_V3.0.6_BF1-0
Firmware Version: 	EU_V3.0.6_stable_branch

Creation Date: 		18 Feb 18:15

Read SHA256: 		11fa3b8273b7e0d987115fa6bc6001a1af1cc9435b3038811246b2006ceee98f
Calculated SHA256: 	11fa3b8273b7e0d987115fa6bc6001a1af1cc9435b3038811246b2006ceee98f
GIT Shorthash: 		aa22b62


Filename: testfolder/foo/mcuimg3.bin
Firmware Version: 	EU_V3.0.8-0
Firmware Version: 	3.0.8_EU

Creation Date: 		14 Oct 17:32

Read SHA256: 		f2ee433e0630a5624324277d763ce3c7aea1630a9a07a4b9817f09550f25fe56
Calculated SHA256: 	f2ee433e0630a5624324277d763ce3c7aea1630a9a07a4b9817f09550f25fe56
GIT Shorthash: 		33d4f3a


Filename: testfolder/foo/mcuimg1.bin
Firmware Version: 	PD_V3.0.7-0
Firmware Version: 	PD_V3.0.7_stable_branch

Creation Date: 		02 Dec 15:18

Read SHA256: 		b35e6e23b859fb32ee9088ebb1a09aae3cac1c93023e66aff536dcea6d5d498b
Calculated SHA256: 	b35e6e23b859fb32ee9088ebb1a09aae3cac1c93023e66aff536dcea6d5d498b
GIT Shorthash: 		39a3af7
% ./firmware_info.py -jr testfolder/   
Found bootinfo file skipped for JSON-Output: 
Slot: [b&#39;\x02&#39;]
Mode: [0]
[
    {
        &#34;Filename&#34;: &#34;testfolder/mcuimg2.bin&#34;,
        &#34;FWInfo&#34;: [
            &#34;EU_V3.0.6_BF1-0&#34;,
            &#34;EU_V3.0.6_stable_branch&#34;
        ],
        &#34;creationDate&#34;: &#34;18 Feb 18:15&#34;,
        &#34;git shorthash&#34;: &#34;aa22b62&#34;,
        &#34;sha256&#34;: &#34;11fa3b8273b7e0d987115fa6bc6001a1af1cc9435b3038811246b2006ceee98f&#34;,
        &#34;calculatedHash&#34;: &#34;11fa3b8273b7e0d987115fa6bc6001a1af1cc9435b3038811246b2006ceee98f&#34;
    },
    {
        &#34;Filename&#34;: &#34;testfolder/mcuimg3.bin&#34;,
        &#34;FWInfo&#34;: [
            &#34;EU_V3.0.8-0&#34;,
            &#34;3.0.8_EU&#34;
        ],
        &#34;creationDate&#34;: &#34;14 Oct 17:32&#34;,
        &#34;git shorthash&#34;: &#34;33d4f3a&#34;,
        &#34;sha256&#34;: &#34;f2ee433e0630a5624324277d763ce3c7aea1630a9a07a4b9817f09550f25fe56&#34;,
        &#34;calculatedHash&#34;: &#34;f2ee433e0630a5624324277d763ce3c7aea1630a9a07a4b9817f09550f25fe56&#34;
    },
    {
        &#34;Filename&#34;: &#34;testfolder/mcuimg1.bin&#34;,
        &#34;FWInfo&#34;: [
            &#34;PD_V3.0.7-0&#34;,
            &#34;PD_V3.0.7_stable_branch&#34;
        ],
        &#34;creationDate&#34;: &#34;02 Dec 15:18&#34;,
        &#34;git shorthash&#34;: &#34;39a3af7&#34;,
        &#34;sha256&#34;: &#34;b35e6e23b859fb32ee9088ebb1a09aae3cac1c93023e66aff536dcea6d5d498b&#34;,
        &#34;calculatedHash&#34;: &#34;b35e6e23b859fb32ee9088ebb1a09aae3cac1c93023e66aff536dcea6d5d498b&#34;
    }
]
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/toniebox-reverse-engineering/toniebox-reverse-engineering.github.io/commit/845b79d080e50612d0f76054cd363799a29ba11b title='Last modified by SciLor | 2023-11-20' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>2023-11-20</span></a></div><div><a class="flex align-center" href=https://github.com/toniebox-reverse-engineering/toniebox-reverse-engineering.github.io/edit/master/content/docs/wiki/cc3200/firmware-layout.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#format-of-toniebox-bootinfo-reversed-with-radare2>Format of Toniebox Bootinfo reversed with radare2</a></li><li><a href=#format-of-toniebox-ofw-image-reversed-with-radare2>Format of Toniebox OFW Image reversed with radare2</a></li><li><a href=#format-of-toneibox-original-bootloader-reversed-with-radare2>Format of Toneibox original bootloader reversed with radare2</a></li><li><a href=#python-tool-for-extracting-all-this-information-by-your-own>Python tool for extracting all this information by your own</a></li></ul></nav></div></aside></main></body></html>